<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSI 5810 - Text Mining Project</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .upload-section {
            border: 3px dashed #667eea;
            padding: 40px;
            text-align: center;
            border-radius: 10px;
            background: #f8f9ff;
            transition: all 0.3s;
        }

        .upload-section:hover {
            background: #eef0ff;
            border-color: #764ba2;
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-label {
            display: inline-block;
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .upload-label:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #48bb78;
        }

        .btn-secondary:hover {
            background: #38a169;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #667eea;
        }

        .stat-box .number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .label {
            color: #666;
            margin-top: 5px;
        }

        .predict-section {
            margin-top: 20px;
        }

        .predict-section textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .result-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .result-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-card .metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px;
        }

        .result-card .metric-name {
            color: #666;
        }

        .result-card .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .prediction-result {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #667eea;
        }

        .sentiment-positive {
            color: #48bb78;
            font-weight: bold;
        }

        .sentiment-negative {
            color: #f56565;
            font-weight: bold;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .viz-card {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .viz-card img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .viz-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #48bb78;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #f56565;
        }

        .alert-info {
            background: #bee3f8;
            color: #2c5282;
            border: 2px solid #4299e1;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .feature-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .feature-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .feature-item.negative {
            border-left-color: #f56565;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .visualization-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç Text Mining & Sentiment Analysis</h1>
            <p>CSI 5810 Project 2 - Product Review Analysis System</p>
            <p style="margin-top: 10px; color: #999;">Upload reviews ‚Ä¢ Train models ‚Ä¢ Analyze sentiment ‚Ä¢ Visualize results</p>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Upload Section -->
            <div class="card">
                <h2>üì§ Data Upload</h2>
                <div class="upload-section">
                    <p style="margin-bottom: 20px; color: #666;">Upload a CSV file with 'review_text' and 'rating' columns</p>
                    <input type="file" id="fileInput" accept=".csv">
                    <label for="fileInput" class="upload-label">Choose CSV File</label>
                    <p id="fileName" style="margin-top: 15px; color: #667eea; font-weight: bold;"></p>
                </div>
                <button class="btn" onclick="uploadFile()" style="margin-top: 20px; width: 100%;">Upload & Preprocess Data</button>
                <button class="btn btn-secondary" onclick="downloadSample()" style="width: 100%;">Download Sample CSV</button>
                
                <div id="uploadAlert"></div>
                <div id="loadingUpload" class="loading">
                    <div class="spinner"></div>
                    <p>Processing data...</p>
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="card">
                <h2>üìä Dataset Statistics</h2>
                <div id="statsContent">
                    <p style="text-align: center; color: #999; padding: 40px;">Upload data to view statistics</p>
                </div>
            </div>

            <!-- Training Section -->
            <div class="card">
                <h2>ü§ñ Model Training</h2>
                <p style="color: #666; margin-bottom: 20px;">Train multiple machine learning models for sentiment classification</p>
                <button class="btn" onclick="trainModels()" id="trainBtn" disabled style="width: 100%;">Train All Models</button>
                <div id="trainAlert"></div>
                <div id="loadingTrain" class="loading">
                    <div class="spinner"></div>
                    <p>Training models... This may take a minute...</p>
                </div>
            </div>

            <!-- Results Section -->
            <div class="card">
                <h2>üìà Model Performance</h2>
                <div id="resultsContent">
                    <p style="text-align: center; color: #999; padding: 40px;">Train models to view results</p>
                </div>
            </div>

            <!-- Prediction Section -->
            <div class="card full-width">
                <h2>üéØ Real-time Prediction</h2>
                <div class="predict-section">
                    <textarea id="reviewText" placeholder="Enter a product review here to predict sentiment..."></textarea>
                    <button class="btn" onclick="predictSentiment()" id="predictBtn" disabled style="margin-top: 15px;">Predict Sentiment</button>
                    <div id="predictionResult"></div>
                </div>
            </div>

            <!-- Visualizations Section -->
            <div class="card full-width">
                <h2>üìä Visualizations</h2>
                <button class="btn btn-secondary" onclick="generateVisualizations()" id="vizBtn" disabled>Generate All Visualizations</button>
                <div id="loadingViz" class="loading">
                    <div class="spinner"></div>
                    <p>Generating visualizations...</p>
                </div>
                <div id="visualizationsContent"></div>
            </div>

            <!-- Feature Importance Section -->
            <div class="card full-width">
                <h2>üîë Feature Importance (Top Words)</h2>
                <button class="btn btn-secondary" onclick="getFeatureImportance()" id="featureBtn" disabled>Show Important Features</button>
                <div id="featureContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Display selected file name
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || '';
            document.getElementById('fileName').textContent = fileName ? `Selected: ${fileName}` : '';
        });

        // Upload and preprocess data
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('uploadAlert', 'Please select a file first!', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            document.getElementById('loadingUpload').style.display = 'block';
            document.getElementById('uploadAlert').innerHTML = '';

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('uploadAlert', data.message, 'success');
                    displayStats(data.stats);
                    document.getElementById('trainBtn').disabled = false;
                } else {
                    showAlert('uploadAlert', data.error, 'error');
                }
            } catch (error) {
                showAlert('uploadAlert', 'Error uploading file: ' + error, 'error');
            } finally {
                document.getElementById('loadingUpload').style.display = 'none';
            }
        }

        // Display statistics
        function displayStats(stats) {
            const html = `
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="number">${stats.total_reviews}</div>
                        <div class="label">Total Reviews</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">${stats.positive_reviews}</div>
                        <div class="label">Positive Reviews</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">${stats.negative_reviews}</div>
                        <div class="label">Negative Reviews</div>
                    </div>
                    <div class="stat-box">
                        <div class="number">${stats.avg_word_count.toFixed(1)}</div>
                        <div class="label">Avg Words/Review</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9ff; border-radius: 10px;">
                    <strong>Rating Distribution:</strong><br>
                    ${Object.entries(stats.rating_distribution).map(([rating, count]) => 
                        `‚≠ê ${rating}-star: ${count} reviews`
                    ).join('<br>')}
                </div>
            `;
            document.getElementById('statsContent').innerHTML = html;
        }

        // Train models
        async function trainModels() {
            document.getElementById('loadingTrain').style.display = 'block';
            document.getElementById('trainAlert').innerHTML = '';

            try {
                const response = await fetch('/train', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('trainAlert', data.message, 'success');
                    displayResults(data.results);
                    document.getElementById('predictBtn').disabled = false;
                    document.getElementById('vizBtn').disabled = false;
                    document.getElementById('featureBtn').disabled = false;
                } else {
                    showAlert('trainAlert', data.error, 'error');
                }
            } catch (error) {
                showAlert('trainAlert', 'Error training models: ' + error, 'error');
            } finally {
                document.getElementById('loadingTrain').style.display = 'none';
            }
        }

        // Display results
        function displayResults(results) {
            const html = `
                <div class="results-grid">
                    ${Object.entries(results).map(([model, metrics]) => `
                        <div class="result-card">
                            <h3>${model}</h3>
                            <div class="metric">
                                <span class="metric-name">Accuracy:</span>
                                <span class="metric-value">${(metrics.accuracy * 100).toFixed(2)}%</span>
                            </div>
                            <div class="metric">
                                <span class="metric-name">Precision:</span>
                                <span class="metric-value">${(metrics.precision * 100).toFixed(2)}%</span>
                            </div>
                            <div class="metric">
                                <span class="metric-name">Recall:</span>
                                <span class="metric-value">${(metrics.recall * 100).toFixed(2)}%</span>
                            </div>
                            <div class="metric">
                                <span class="metric-name">F1-Score:</span>
                                <span class="metric-value">${(metrics.f1_score * 100).toFixed(2)}%</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('resultsContent').innerHTML = html;
        }

        // Predict sentiment
        async function predictSentiment() {
            const reviewText = document.getElementById('reviewText').value;
            
            if (!reviewText.trim()) {
                alert('Please enter a review text!');
                return;
            }

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ review_text: reviewText })
                });

                const data = await response.json();

                if (data.success) {
                    displayPrediction(data.predictions);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error predicting sentiment: ' + error);
            }
        }

        // Display prediction
        function displayPrediction(predictions) {
            const html = `
                <div class="prediction-result">
                    <h3 style="color: #667eea; margin-bottom: 15px;">Prediction Results:</h3>
                    ${Object.entries(predictions).map(([model, pred]) => `
                        <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px;">
                            <strong>${model}:</strong>
                            <span class="sentiment-${pred.sentiment.toLowerCase()}">${pred.sentiment}</span>
                            ${pred.confidence ? ` (Confidence: ${(pred.confidence * 100).toFixed(1)}%)` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('predictionResult').innerHTML = html;
        }

        // Generate visualizations
        async function generateVisualizations() {
            document.getElementById('loadingViz').style.display = 'block';
            document.getElementById('visualizationsContent').innerHTML = '';

            try {
                const response = await fetch('/visualizations');
                const data = await response.json();

                if (data.success) {
                    displayVisualizations(data.plots);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error generating visualizations: ' + error);
            } finally {
                document.getElementById('loadingViz').style.display = 'none';
            }
        }

        // Display visualizations
        function displayVisualizations(plots) {
            const plotOrder = [
                { key: 'rating_dist', title: 'Rating Distribution' },
                { key: 'model_comparison', title: 'Model Comparison' },
                { key: 'wordcloud_positive', title: 'Positive Reviews Word Cloud' },
                { key: 'wordcloud_negative', title: 'Negative Reviews Word Cloud' },
                { key: 'confusion_matrices', title: 'Confusion Matrices', fullWidth: true },
                { key: 'roc_curves', title: 'ROC Curves', fullWidth: true }
            ];

            const html = `
                <div class="visualization-grid">
                    ${plotOrder.map(plot => {
                        if (!plots[plot.key]) return '';
                        return `
                            <div class="viz-card ${plot.fullWidth ? 'full-width' : ''}" style="${plot.fullWidth ? 'grid-column: 1 / -1;' : ''}">
                                <h3>${plot.title}</h3>
                                <img src="data:image/png;base64,${plots[plot.key]}" alt="${plot.title}">
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            document.getElementById('visualizationsContent').innerHTML = html;
        }

        // Get feature importance
        async function getFeatureImportance() {
            try {
                const response = await fetch('/feature-importance');
                const data = await response.json();

                if (data.success) {
                    displayFeatures(data.positive_features, data.negative_features);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error getting features: ' + error);
            }
        }

        // Display features
        function displayFeatures(positive, negative) {
            const html = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h3 style="color: #48bb78; margin-bottom: 15px;">‚úÖ Top Positive Words</h3>
                        <div class="feature-list">
                            ${positive.map(f => `
                                <div class="feature-item">
                                    <span>${f.word}</span>
                                    <span style="color: #48bb78; font-weight: bold;">${f.importance.toFixed(4)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #f56565; margin-bottom: 15px;">‚ùå Top Negative Words</h3>
                        <div class="feature-list">
                            ${negative.map(f => `
                                <div class="feature-item negative">
                                    <span>${f.word}</span>
                                    <span style="color: #f56565; font-weight: bold;">${f.importance.toFixed(4)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('featureContent').innerHTML = html;
        }

        // Download sample CSV
        function downloadSample() {
            window.location.href = '/download-sample';
        }

        // Show alert
        function showAlert(elementId, message, type) {
            const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-error' : 'alert-info';
            document.getElementById(elementId).innerHTML = `
                <div class="alert ${alertClass}">${message}</div>
            `;
        }
    </script>
</body>
</html>